Γιώργος Μητρόπουλος
sdi 2000128

Μεταγλώττιση και εκτέλεση: 
make  
./mysh

make clean: για remove τα εκτελέσιμα

ΠΑΡΑΔΟΧΕΣ: ΠΡΙΝ και ΜΕΤΑ από κάθε {> , < , >>, |}  πρέπει να υπάρχει whitespace.
Για όλα τα άλλα σύμβολα το πρόγραμμα τρέχει σωστά και κολλητά και με whitespace.

Τα test cases που μας δόθηκαν λειτουργούν όπως θα πρέπει.

Γενικά υπάρχουν 5 αρχεία .c, ένα .h και ένα Makefile.

main:
Υπάρχουν στην αρχή κάποιες δηλώσεις χρήσιμων μεταβλητών ,
Το πρόγραμμα αρχίζει με ένα λουπ που τρέχει επ αόριστον (exit). υπάρχουν 2 signal handlers (^C,^Z). οι οποίοι αν υπάρχει ενεργή εσωτερική διαδικασία (σε foreground) την σκοτώνουν ή των σταματάνε αντίστοιχα (SIG_DFL), αλλιώς δεν επηρεάζεται το κέλυφος (SIG_IGN).

Έπειτα τυπώνεται: in-my-mysh>
καλειται συνάρτηση input η οποία περιμένει είσοδο απο το πληκτρολόγιο και επιστρέφει την συμβολοσειρά που πληκτρολογήθηκε.
Αν πληκτρολογήθηκε exit τοτε τερματίζει το πρόγραμμα μετά απο απαραίτητα frees(αν χρειάζονται).

Καλείται συνάρτηση count_strs(str) η οποία παιρνει σαν όρισμα την συμβολοσειρά και επιστρέφει ενα πίνακα ο οποίος σε καθε γραμμή έχει την κάθε διαφορετική εντολή που δόθηκε με ; και σε κάθε στήλη έχει κάνει σπλιτ την εντολή στην γραμμή που βρίσκεται ανάλογα με τά | που υπάρχουν.

Συνεχίζεται η εκτέλεση στην main με ενα λουπ (για κάθε εντολή που δόθηκε , αν δοθηκε (ls;echo a;)τότε εχουμε 2 εντολές.)
ελέγχουμε αν υπάρχει το σύμβολο & μέσα στην εντολή για να γνωρίζω αν ειναι backround ή όχι η εντολή.

waitpid(-1,&status,WNOHANG); 
checking if a child has terminated and its status is available,(for backround commands)

Στην συνέχεια προστίθεται στο history list το command και με την εντολή
tokens= lsh_split_line(str2); , επιστρέφεται σε καθε tokens[i] καθε λέξη του string που δόθηκε. Συγκεκριμένα η συνάρτηση αυτή, κανει σπλιτ την συμβολοσειρά ,με βάση τα whitespace και αν βρει " τότε βάζει σε ενα μονο τοκέν αυτα που περιέχονται στα " ", επίσης απαλοίφει τα &,; και "".

Καλείται η συνάρτηση alias η οποία αν δόθηκε createalias alias command τοτε κάνει add to command kai to alias στο alias list, αν δόθηκε destroyalias alias τότε διαγράφει το alias απο το alias list , αλλιώς αν δεν δόθηκε τόποτα από αυτά ψάχνει αν υπάρχει κάποιο command στο alias list που να ισούτε με αυτό που δόθηκε.
Ανάλογα με την περίπτωση γίνονται απαραίτητα frees.

Έπειτα με παρόμοια λογική καλείται η συνάρτηση history (αν το πρωτο τοκεν που δόθηκε ηταν ="myHistory"). Αν επέστρεψε 1 τότε η εντολή ήταν myHistory όπου εκτυπώθηκε το History με τις 20 τελευταίες εντολές. Αν επέστρεψε 0 τότε η εντολή ήταν myHistory number με number<21, number>0 όπου εκτυπώθηκε το History με τις 20 τελευταίες εντολές. Aν επέστρεψε -1 τότε δόθηκε λάθος εντολή. Γίνονται πάλι τα απαραίτητα free.

Στην συνέχεια αν δεν υπάρχει σωλήνωση στην εντολή καλείται η command handler.
όπου παίρνει σαν όρισμα τα τοκενς, ενα int bg για το αν ειναι backround η εντολή ή όχι και άλλο ενα όρισμα για το process group.

H συνάρτηση αυτή δημιουργεί μια καινούρια μεταβλητή ώστε να απομονώσει όλα τα τοκενς που βρίσκονται πριν απο τα σύμβολα: (<,>,>>,&). και στην συνέχεια εκτελείται η fileIO.Εκεί γίνεται φορκ ένα παιδί το οποίο δημιουργεί process group για backround commands , ελέγχει αν υπάρχουν wild characters ή redirections όπου ανοίγει/ δημιουργεί τα κατάλληλα και αρχεία και τελος κάνει exec.
Αντίθετα ο πατέρας περιμένει να τερματίσει το παιδί (αν η εντολη ηταν foreground)

Aν υπάρχει σωλήνωση, γίνονται παρόμοιες ενέργειες με την διαφορά οτι το πρόγραμμα διαχείριζεται και την σωλήνωση.


